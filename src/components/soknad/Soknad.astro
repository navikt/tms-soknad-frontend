---
import { getSoknadUrl } from "@src/utils/server/urls";
import type { Language } from "@src/language/language";
import Innsendt from "../innsendt/Innsendt";
import Manglende from "../manglende/Manglende";
import EttersendteVedlegg from "../ettersendt/EttersendteVedlegg"
import type { SoknadsData, SoknadsObject } from "./SoknadType";
import { Heading } from "@navikt/ds-react";
import styles from "./Soknad.module.css";
import { fetchSoknad } from "@src/utils/server/fetchSoknad";

const { soknadsId } = Astro.props;

let soknad: SoknadsObject | null = null;
let soknadsFetchError: boolean = false;

try {
  soknad = await fetchSoknad(Astro.locals.token, soknadsId);
} catch (error: any) {
  console.log(error)
  console.error('Fetch failed.', error.message);
  soknadsFetchError = true;
}

const ettersendteVedlegg = soknad?.mottatteVedlegg.filter((vedlegg) => vedlegg.erEttersending)

const language = Astro.currentLocale as Language;

---


<div class={styles.container}>
  <Heading className={styles.heading} level="1" size="large"
    >{soknad?.tittel}</Heading
  >
  {
    soknad?.manglendeVedlegg && (
      <Manglende
        client:only="react"
        manglendeVedlegg={soknad?.manglendeVedlegg}
        ettersendingsfrist={soknad?.fristEttersending}
      />
    )
  }
  <Innsendt client:only="react" soknad={soknad} />
  <EttersendteVedlegg client:only="react" ettersendteVedlegg={ettersendteVedlegg}/>
</div>
